{% extends "base.html" %}

{% block content %}
<h3>Log Hours</h3>

<form method="post">
  <label>Client</label>
  <select id="client" name="client_id" required onchange="loadProjects()">
    <option value="">-- choose client --</option>
    {% for c in clients %}
      <option value="{{ c.id }}">{{ c.name }}</option>
    {% endfor %}
  </select>

  <label>Project</label>
  <select id="project" name="project_id" required></select>

  <label>Date</label>
  <input type="date" name="date" value="{{ today }}" required>

  <label>Hours</label>
  <input type="number" step="0.01" name="hours" required>

  <label>Description</label>
  <textarea name="description"></textarea>

  <button>Save hours</button>
</form>

{% if hours %}
<table>
  <tr>
    <th>Date</th>
    <th>Client</th>
    <th>Project</th>
    <th>Hours</th>
    <th>Description</th>
  </tr>
  {% for h in hours %}
  <tr>
    <td>{{ h.date }}</td>
    <td>{{ h.client.name }}</td>
    <td>{{ h.project.description or "-" }}</td>
    <td>{{ h.hours }}</td>
    <td>{{ h.description or "-" }}</td>
  </tr>
  {% endfor %}
</table>
{% else %}
<p>No hours logged yet.</p>
{% endif %}

<script>
function loadProjects() {
  const clientId = document.getElementById('client').value;
  const projectSelect = document.getElementById('project');
  projectSelect.innerHTML = '';

  if (!clientId) return;

  fetch('/api/projects?client_id=' + clientId)
    .then(res => res.json())
    .then(data => {
      data.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p.id;
        opt.textContent = p.description || ('Project ' + p.id);
        projectSelect.appendChild(opt);
      });
    });
}
</script>
{% endblock %}
